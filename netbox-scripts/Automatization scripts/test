variables:
  ANSIBLE_CONFIG: ./ansible.cfg

stages:
  - deliver_scripts
  - update_scripts

# NetBox jobs (существующие)
Deliver Scripts NetBox:
  stage: deliver_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook deliver_scripts_netbox.yaml -e ansible_password=$ANSIBLE_PASSWORD -e HPNA_LOGIN=$HPNA_LOGIN -e HPNA_PASSWORD=$HPNA_PASSWORD -e NETBOX_URL=$NETBOX_URL -e NETBOX_TOKEN=$NETBOX_TOKEN -e HPNA_WEB_LOGIN=$HPNA_WEB_LOGIN -e HPNA_WEB_PASSWORD=$HPNA_WEB_PASSWORD"
  only:
    refs:
      - main

# Nautobot jobs (новые)
Deliver Scripts Nautobot:
  stage: deliver_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook deliver_scripts_nautobot.yaml -e ansible_password=$ANSIBLE_PASSWORD -e NAUTOBOT_URL=$NAUTOBOT_URL -e NAUTOBOT_TOKEN=$NAUTOBOT_TOKEN -e HPNA_LOGIN=$HPNA_LOGIN -e HPNA_PASSWORD=$HPNA_PASSWORD -e HPNA_WEB_LOGIN=$HPNA_WEB_LOGIN -e HPNA_WEB_PASSWORD=$HPNA_WEB_PASSWORD"
  only:
    refs:
      - main

# NetBox update jobs
Update Vlans NetBox:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_netbox.yaml -e SCRIPT_NAME=get_vlan.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update Prefix NetBox:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_netbox.yaml -e SCRIPT_NAME=get_prefix.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update ARP NetBox:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_netbox.yaml -e SCRIPT_NAME=get_arp.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update Interface on netbox:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_netbox.yaml -e SCRIPT_NAME=get_interface.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update Inventory NetBox:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_netbox.yaml -e SCRIPT_NAME=get_interface.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update vlans on interface NetBox:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_netbox.yaml -e SCRIPT_NAME=get_vlans_on_interface.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update VNI NetBox:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_netbox.yaml -e SCRIPT_NAME=get_vni_fabric.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update VRF NetBox:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_netbox.yaml -e SCRIPT_NAME=get_vrf.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update Device NetBox:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_netbox.yaml -e SCRIPT_NAME=get_device.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

# Nautobot update jobs (новые)
Update Vlans Nautobot:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_nautobot.yaml -e SCRIPT_NAME=get_vlan.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update Prefix Nautobot:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_nautobot.yaml -e SCRIPT_NAME=get_prefix.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update ARP Nautobot:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_nautobot.yaml -e SCRIPT_NAME=get_arp.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update Interface on nautobot:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_nautobot.yaml -e SCRIPT_NAME=get_interface.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update Inventory Nautobot:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_nautobot.yaml -e SCRIPT_NAME=get_interface.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update vlans on interface Nautobot:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_nautobot.yaml -e SCRIPT_NAME=get_vlans_on_interface.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update VNI Nautobot:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_nautobot.yaml -e SCRIPT_NAME=get_vni_fabric.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update VRF Nautobot:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_nautobot.yaml -e SCRIPT_NAME=get_vrf.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual

Update Device Nautobot:
  stage: update_scripts
  image: artifactory.raiffeisen.ru/ext-devops-community-docker/ansible:8.1.0
  environment:
    name: main
  script:
    - "ansible-playbook -v run_scripts_nautobot.yaml -e SCRIPT_NAME=get_device.py -e ansible_password=$ANSIBLE_PASSWORD"
  only:
    refs:
      - main
  when: manual
